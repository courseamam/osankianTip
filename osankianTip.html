<!DOCTYPE html>
<html>
  <head>
    <title>Osankian Tip</title>
    <script src="https://cdn.jsdeliver.net/npm/chart.js"></script>
  </head>
  <body>
    <h1>Osankian Tip</h1>
    <h2>One tip a day</h2>

    <!-- Display 3 text values -->
    <div>
      <p>Value A: <span id="valA"></span></p>
      <p>Value A: <span id="valA"></span></p>
      <p>Value A: <span id="valA"></span></p>
    </div>

    <!-- Display chart -->
    <canvas id="LugianChart" width="400" height="200"></canvas>

    <script>
      const sheetID = "1-FnlsnezCjsXKwW5PdYCkWW2gYN7ccQYccY-LMSwh_0";
      const url = 'https://docs.google.com/spreadsheets/d/${sheetID}/gviz/tq?tqx=out:json';

      fetch(url);
        .then(res => res.text())
        .then(text => {
          // Strip google visualization JSON wrapper
          const json = JSON.parse(text.substring(47, text.length - 2));
          const rows = json.table.rows;

          // Extract data
          let labels = [];
          let valuesA = [];
          let valuesB = [];
          let valuesC = [];

          rows.forEach(r => {
            labels.push(r.c[0].v); //Date
            valuesA.push(r.c[1].v); //ValueA
            valuesB.push(r.c[1].v); //ValueB
            valuesC.push(r.c[1].v); //ValueC
          });

          // Update latest values
          document.getElementById("valA").textContent = valuesA.at(-1);
          document.getElementById("valB").textContent = valuesB.at(-1);
          document.getElementById("valC").textContent = valuesC.at(-1);

          // Draw chart
          new Chart(document.getElementById("LugianChart"), {
            type: "line",
            data: {
              labels:labels,
              datasets: [
                { label: "Value A", data: valuesA, borderColor: "red", fill: false },
                { label: "Value B", data: valuesB, borderColor: "blue", fill: false },
                { label: "Value C", data: valuesC, borderColor: "green", fill: false }
              ]
            }
          });
        });
    </script>
  </body>
</html>
